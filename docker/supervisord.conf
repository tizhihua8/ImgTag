[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid

[program:postgresql]
command=/usr/lib/postgresql/16/bin/postgres -D /var/lib/postgresql/data
user=postgres
autorestart=true
priority=1
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:imgtag-app]
# Wait for DB to be ready is handled by app retry logic or separate script, 
# but here we rely on the app's startup db-check defined in main.py/lifespan
command=/app/venv/bin/python -m uvicorn imgtag.main:app --host 0.0.0.0 --port 8000
directory=/app
environment=STATIC_DIR="/app/web_dist",PG_CONNECTION_STRING="postgresql://imgtag:imgtag@127.0.0.1:5432/imgtag"
user=root
autorestart=true
priority=2
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
